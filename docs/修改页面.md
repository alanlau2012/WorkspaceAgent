 │  Plan (accepted)                                                                     │ 
 │ ┌──────────────────────────────────────────────────────────────────────────────────┐ │ 
 │ │ Objective                                                                        │ │ 
 │ │ 将现有主界面按设计稿 design/workspace-agent-ui-mockup.html                       │ │ 
 │ │ 的深色高保真样式改造为三栏布局（左文件树 + 中预览 + 右聊天）并保留现有功能与测   │ │ 
 │ │ 试，通过TDD方式逐步推进，先写/调整测试，再做最小实现。                           │ │ 
 │ │ 关键现状与设计映射                                                               │ │ 
 │ │ • 现有主界面结构（Antd Layout + 两侧 Sider）如下：                               │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  src/App.jsx lines 19-37                                                         │ │ 
 │ │                                                                                  │ │ 
 │ │   19 │      <Layout style={{ height: '100vh' }}>                                 │ │
 │ │   20 │        <Sider width={300} style={{ background: '#fff' }}>                 │ │
 │ │   21 │          <FileTree                                                        │ │
 │ │   22 │            onFileSelect={handleFileSelect}                                │ │ 
 │ │   23 │            showSearch={true}                                              │ │ 
 │ │   24 │          />                                                               │ │ 
 │ │   25 │        </Sider>                                                           │ │ 
 │ │   26 │        <Content style={{ padding: '16px' }}>                              │ │ 
 │ │   27 │          <FilePreview file={selectedFile} />                              │ │ 
 │ │   28 │        </Content>                                                         │ │ 
 │ │   29 │        <Sider width={360} style={{ background: '#fff', borderLeft: '1px   │ │ 
 │ │      │ solid #e8e8e8' }}>                                                        │ │ 
 │ │   30 │          <ChatPanel                                                       │ │ 
 │ │   31 │            context={{                                                     │ │ 
 │ │   32 │              selectedFile,                                                │ │ 
 │ │   33 │              workspacePath: window.__WORKSPACE_PATH__ || ''               │ │ 
 │ │   34 │            }}                                                             │ │ 
 │ │   35 │          />                                                               │ │ 
 │ │   36 │        </Sider>                                                           │ │ 
 │ │   37 │      </Layout>                                                            │ │ 
 │ │                                                                                  │ │ 
 │ │ • 当前样式为浅色：                                                               │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  src/components/FileTree.css lines 1-7                                           │ │ 
 │ │                                                                                  │ │ 
 │ │    1 │.file-tree {                                                               │ │ 
 │ │    2 │  height: 100%;                                                            │ │ 
 │ │    3 │  display: flex;                                                           │ │ 
 │ │    4 │  flex-direction: column;                                                  │ │ 
 │ │    5 │  background: #fff;                                                        │ │ 
 │ │    6 │  border-right: 1px solid #e8e8e8;                                         │ │ 
 │ │    7 │}                                                                          │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  src/components/Chat/ChatPanel.css lines 1-7                                     │ │ 
 │ │                                                                                  │ │ 
 │ │    1 │.chat-panel {                                                              │ │ 
 │ │    2 │  height: 100%;                                                            │ │ 
 │ │    3 │  display: flex;                                                           │ │ 
 │ │    4 │  flex-direction: column;                                                  │ │ 
 │ │    5 │  background: #fff;                                                        │ │ 
 │ │    6 │  border-left: 1px solid #e8e8e8;                                          │ │ 
 │ │    7 │}                                                                          │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  src/components/FilePreview.css lines 8-12                                       │ │ 
 │ │                                                                                  │ │ 
 │ │    8 │.file-preview-header {                                                     │ │ 
 │ │    9 │  padding: 16px;                                                           │ │ 
 │ │   10 │  border-bottom: 1px solid #e8e8e8;                                        │ │ 
 │ │   11 │  background: #fafafa;                                                     │ │ 
 │ │   12 │}                                                                          │ │ 
 │ │                                                                                  │ │ 
 │ │ • 设计稿核心（颜色变量与布局）：                                                 │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  design/workspace-agent-ui-mockup.html lines 9-24                                │ │ 
 │ │                                                                                  │ │ 
 │ │    9 │        :root {                                                            │ │ 
 │ │   10 │            /* 主色调 - Cursor 蓝色系 */                                   │ │ 
 │ │   11 │            --primary-50: #0f1419;                                         │ │ 
 │ │   12 │            --primary-100: #1a1f29;                                        │ │ 
 │ │   13 │            --primary-200: #252a35;                                        │ │ 
 │ │   14 │            --primary-300: #2d3441;                                        │ │ 
 │ │   15 │            --primary-400: #383e4d;                                        │ │ 
 │ │   16 │            --primary-500: #4c5566;                                        │ │ 
 │ │   17 │            --primary-600: #6b7280;                                        │ │ 
 │ │   18 │            --primary-700: #9ca3af;                                        │ │ 
 │ │   19 │            --primary-800: #d1d5db;                                        │ │ 
 │ │   20 │            --primary-900: #f3f4f6;                                        │ │ 
 │ │   21 │            /* 品牌色 */                                                   │ │ 
 │ │   22 │            --brand-primary: #007acc;                                      │ │ 
 │ │   23 │            --brand-secondary: #1e90ff;                                    │ │ 
 │ │   24 │            --brand-accent: #00d4ff;                                       │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  design/workspace-agent-ui-mockup.html lines 33-40                               │ │ 
 │ │                                                                                  │ │ 
 │ │   33 │            /* 背景层级 */                                                 │ │ 
 │ │   34 │            --bg-primary: #0d1117;                                         │ │ 
 │ │   35 │            --bg-secondary: #161b22;                                       │ │ 
 │ │   36 │            --bg-tertiary: #21262d;                                        │ │ 
 │ │   37 │            --bg-overlay: #30363d;                                         │ │ 
 │ │   38 │            --bg-elevated: #373e47;                                        │ │ 
 │ │   39 │            /* 边框色 */                                                   │ │ 
 │ │   40 │            --border-primary: #30363d;                                     │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  design/workspace-agent-ui-mockup.html lines 112-120                             │ │ 
 │ │                                                                                  │ │ 
 │ │  112 │        .titlebar {                                                        │ │ 
 │ │  113 │            position: fixed;                                               │ │ 
 │ │  114 │            top: 0; left: 0; right: 0; height: 32px;                       │ │ 
 │ │  115 │            background: var(--bg-secondary);                               │ │ 
 │ │  116 │            border-bottom: 1px solid var(--border-primary);                │ │ 
 │ │  117 │            display: flex; align-items: center; justify-content: center;   │ │ 
 │ │  118 │            z-index: 1000; -webkit-app-region: drag;                       │ │ 
 │ │  119 │        }                                                                  │ │ 
 │ │  120 │        .titlebar-title { font-size: var(--text-xs); color:                │ │ 
 │ │      │var(--text-secondary); font-weight: 500; }                                 │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  design/workspace-agent-ui-mockup.html lines 142-148                             │ │ 
 │ │                                                                                  │ │ 
 │ │  142 │        .file-tree-panel {                                                 │ │ 
 │ │  143 │            width: 300px; min-width: 200px; max-width: 500px;              │ │ 
 │ │  144 │            background: var(--bg-secondary);                               │ │ 
 │ │  145 │            border-right: 1px solid var(--border-primary);                 │ │ 
 │ │  146 │            display: flex; flex-direction: column;                         │ │ 
 │ │  147 │            resize: horizontal; overflow: hidden;                          │ │ 
 │ │  148 │        }                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  design/workspace-agent-ui-mockup.html lines 355-360                             │ │ 
 │ │                                                                                  │ │ 
 │ │  355 │        .chat-panel {                                                      │ │ 
 │ │  356 │            width: 350px; min-width: 300px; max-width: 600px;              │ │ 
 │ │  357 │            background: var(--bg-secondary);                               │ │ 
 │ │  358 │            border-left: 1px solid var(--border-primary);                  │ │ 
 │ │  359 │            display: flex; flex-direction: column; resize: horizontal;     │ │ 
 │ │  360 │        }                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │ 需要确认的决策（请答复后我可微调计划）                                           │ │ 
 │ │ • 是否现在启用自定义标题栏（frame:                                               │ │ 
 │ │   false）？启用则需要窗口控制按钮与IPC，且要改                                   │ │ 
 │ │   windowOptions；不启用则先在内容区实现视觉等效标题栏，后续再切换。              │ │ 
 │ │ • 是否去除 Antd Layout 依赖（仅 App.jsx                                          │ │ 
 │ │   使用）？建议移除以实现更贴近设计的可调整宽度布局。                             │ │ 
 │ │ • E2E 目前验证 src/index.html 的“你好，Electron！”。本次是否一并升级 E2E         │ │ 
 │ │   覆盖 React 界面（或先保持不动，后续再做）？                                    │ │ 
 │ │                                                                                  │ │ 
 │ │ 实施顺序（TDD 红-绿-重构）                                                       │ │ 
 │ │ 1. 基线测试与新UI测试                                                            │ │ 
 │ │ • 保持现有单测全部通过（ChatPanel/FileTree/FilePreview 等）。                    │ │ 
 │ │ • 新增布局/标题栏可见性的测试（先写失败）：                                      │ │ 
 │ │   • 新增 src/__tests__/AppLayout.test.jsx：                                      │ │ 
 │ │     • 渲染 <App /> 后，断言出现“WorkspaceAgent - AI                              │ │ 
 │ │       文件管理助手”（标题栏），出现“工作区文件”（左侧header），保持“AI           │ │ 
 │ │       助手”（右侧header）。                                                      │ │ 
 │ │   • 如果启用自定义标题栏，再新增主进程配置测试（见步骤7）。                      │ │ 
 │ │ 2. 建立主题与全局布局样式（新增文件）                                            │ │ 
 │ │ • 创建 src/styles/tokens.css：把设计稿的 :root                                   │ │ 
 │ │   变量复制过来（按需精简），以及滚动条/字体等 reset。                            │ │ 
 │ │ • 创建 src/styles/layout.css：包含 app-container、titlebar、main-content、fi     │ │ 
 │ │   le-tree-panel、preview-panel、chat-panel 等结构样式（与设计一致）。            │ │ 
 │ │ • 修改 src/index.jsx 引入全局样式（先写测试：检查 DOM 上 class                   │ │ 
 │ │   存在/文本存在即可）：                                                          │ │ 
 │ │   • 在文件顶部新增 import './styles/tokens.css'; import                          │ │ 
 │ │     './styles/layout.css';                                                       │ │ 
 │ │ 3. 重构 App.jsx 的结构（去除 Antd Layout，最小实现）                             │ │ 
 │ │ • 目标：按设计实现三栏布局与标题栏的 DOM 结构，功能仍用现有子组件。              │ │ 
 │ │ • 修改项：                                                                       │ │ 
 │ │   • 移除 antd 的 Layout/Sider/Content 引用与使用。                               │ │ 
 │ │   • 使用 div.app-container > div.titlebar + div.main-content，自定义三栏：       │ │ 
 │ │     • aside.file-tree-panel（可 resize: horizontal）                             │ │ 
 │ │     • section.preview-panel                                                      │ │ 
 │ │     • aside.chat-panel（可 resize: horizontal）                                  │ │ 
 │ │   • 在左侧加入“工作区文件”标题、简单工具栏按钮（占位）和搜索框（复用             │ │ 
 │ │     FileTree 的 showSearch）。                                                   │ │ 
 │ │ • 提示：标题栏文本使用 “WorkspaceAgent - AI 文件管理助手”。                      │ │ 
 │ │ • 示例（供实现时参考）：                                                         │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │    1 │import './styles/tokens.css';                                              │ │ 
 │ │    2 │import './styles/layout.css';                                              │ │ 
 │ │    3 │// ...                                                                     │ │ 
 │ │    4 │return (                                                                   │ │ 
 │ │    5 │  <div className="app-container">                                          │ │ 
 │ │    6 │    <div className="titlebar">                                             │ │ 
 │ │    7 │      <div className="titlebar-title">WorkspaceAgent - AI                  │ │ 
 │ │      │文件管理助手</div>                                                         │ │ 
 │ │    8 │    </div>                                                                 │ │ 
 │ │    9 │    <div className="main-content">                                         │ │ 
 │ │   10 │      <aside className="file-tree-panel" style={{ resize: 'horizontal',    │ │ 
 │ │      │overflow: 'hidden' }}>                                                     │ │ 
 │ │   11 │        <div className="file-tree-header">                                 │ │ 
 │ │   12 │          <div className="file-tree-title">工作区文件</div>                │ │ 
 │ │   13 │          {/* 工具栏占位按钮 */}                                           │ │ 
 │ │   14 │          <div className="file-tree-toolbar">                              │ │ 
 │ │   15 │            <button className="toolbar-btn">📁 打开</button>               │ │ 
 │ │   16 │            <button className="toolbar-btn">🔄 刷新</button>               │ │ 
 │ │   17 │            <button className="toolbar-btn">➕ 新建</button>               │ │ 
 │ │   18 │          </div>                                                           │ │ 
 │ │   19 │          {/* 使用原有 FileTree 的搜索 */}                                 │ │ 
 │ │   20 │        </div>                                                             │ │ 
 │ │   21 │        <FileTree onFileSelect={handleFileSelect} showSearch={true} />     │ │ 
 │ │   22 │      </aside>                                                             │ │ 
 │ │   23 │      <section className="preview-panel">                                  │ │ 
 │ │   24 │        <div className="preview-header">                                   │ │ 
 │ │   25 │          {/* 根据选择文件显示名称与路径，占位即可 */}                     │ │ 
 │ │   26 │        </div>                                                             │ │ 
 │ │   27 │        <div className="preview-content">                                  │ │ 
 │ │   28 │          <FilePreview file={selectedFile} />                              │ │ 
 │ │   29 │        </div>                                                             │ │ 
 │ │   30 │      </section>                                                           │ │ 
 │ │   31 │      <aside className="chat-panel" style={{ resize: 'horizontal' }}>      │ │ 
 │ │   32 │        <ChatPanel context={{ selectedFile, workspacePath:                 │ │ 
 │ │      │window.__WORKSPACE_PATH__ || '' }} />                                      │ │ 
 │ │   33 │      </aside>                                                             │ │ 
 │ │   34 │    </div>                                                                 │ │ 
 │ │   35 │  </div>                                                                   │ │ 
 │ │   36 │)                                                                          │ │ 
 │ │                                                                                  │ │ 
 │ │ • 更新/新增测试：AppLayout.test.jsx 断言上述文本可见；现有 App.test.jsx          │ │ 
 │ │   依然应通过（仍有“AI 助手”）。                                                  │ │ 
 │ │ 4. 组件样式深色化与变量化（逐个组件最小替换）                                    │ │ 
 │ │ • FileTree.css：把浅色固定色替换为 tokens（不改变 DOM 结构，减小影响）           │ │ 
 │ │   • 替换点：background、border、hover 颜色、输入框颜色。                         │ │ 
 │ │   • 参考：                                                                       │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  src/components/FileTree.css lines 1-1                                           │ │ 
 │ │                                                                                  │ │ 
 │ │ .file-tree { /* 改为 */ background: var(--bg-secondary); border-right: 1px       │ │ 
 │ │ solid var(--border-primary); }                                                   │ │ 
 │ │                                                                                  │ │ 
 │ │   • 搜索框 .search-input 的边框/焦点阴影改为                                     │ │ 
 │ │     var(--border-secondary)/var(--border-focus)。                                │ │ 
 │ │ • FilePreview.css：header 与 code 区背景/边框替换为 tokens                       │ │ 
 │ │   • 替换点：                                                                     │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  src/components/FilePreview.css lines 8-8                                        │ │ 
 │ │                                                                                  │ │ 
 │ │ .file-preview-header { /* 改为 */ border-bottom: 1px solid                       │ │ 
 │ │ var(--border-primary); background: var(--bg-tertiary); }                         │ │ 
 │ │                                                                                  │ │ 
 │ │   • code/pre 背景与文字：使用 var(--bg-secondary)/var(--text-primary)。          │ │ 
 │ │ • ChatPanel.css：外层容器与分隔线、输入背景、按钮颜色变量化（保留 DOM            │ │ 
 │ │   与测试不变）                                                                   │ │ 
 │ │   • 关键替换：                                                                   │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  src/components/Chat/ChatPanel.css lines 1-1                                     │ │ 
 │ │                                                                                  │ │ 
 │ │ .chat-panel { background: var(--bg-secondary); border-left: 1px solid            │ │ 
 │ │ var(--border-primary); }                                                         │ │ 
 │ │                                                                                  │ │ 
 │ │   • header 背景 var(--bg-tertiary)，select/input 边框                            │ │ 
 │ │     var(--border-secondary)，聚焦 var(--border-focus)，按钮主色                  │ │ 
 │ │     var(--brand-primary)。                                                       │ │ 
 │ │ • 写单测（可在现有测试基础上新增轻量快照或样式 class                             │ │ 
 │ │   断言）确保结构与文本不变，避免功能回归。                                       │ │ 
 │ │ 5. 预览区头部与信息展示（增强但不影响现有测试）                                  │ │ 
 │ │ • 在 App.jsx 的 .preview-header 内展示已选文件名与路径（使用现有 FilePreview     │ │ 
 │ │   的 file prop 信息即可）；                                                      │ │ 
 │ │ • 若无文件，显示占位文本；                                                       │ │ 
 │ │ • 新增轻量测试：当未选文件时显示“请选择一个文件进行预览”（现 FilePreview         │ │ 
 │ │   已有），当选中文件时 .preview-header 中出现文件名。                            │ │ 
 │ │ 6. 可调整面板宽度（使用原生 CSS resize）                                         │ │ 
 │ │ • 左/右侧面板添加 style={{ resize: 'horizontal' }} 与合适的                      │ │ 
 │ │   min/max-width（已在 layout.css 中定义）；                                      │ │ 
 │ │ • 验证在常用分辨率下不溢出；                                                     │ │ 
 │ │ • 无需新增逻辑单测，仅人工验证 + 视觉检查；                                      │ │ 
 │ │ 7. 可选：启用自定义标题栏（frame: false）与窗体背景色                            │ │ 
 │ │ • 若确认启用：                                                                   │ │ 
 │ │   • 修改 src/main/windowOptions.js：增加 frame: false（Win/Linux），背景色       │ │ 
 │ │     backgroundColor: '#0d1117' 以避免白屏闪烁；                                  │ │ 
 │ │   • Mac 可考虑 titleBarStyle: 'hiddenInset'；                                    │ │ 
 │ │   • 为此添加/更新测试：                                                          │ │ 
 │ │                                                                                  │ │ 
 │ │                                                                                  │ │ 
 │ │  src/main/__tests__/windowOptions.test.js lines 1-1                              │ │ 
 │ │                                                                                  │ │ 
 │ │   test('安全选项应启用 contextIsolation/nodeIntegration/sandbox', ...)           │ │ 
 │ │                                                                                  │ │ 
 │ │   • 新增测试用例：在开启 FEATURE_CUSTOM_TITLEBAR 环境变量时，期望 frame 为       │ │ 
 │ │     false/背景色匹配；在默认关闭时保持现状。                                     │ │ 
 │ │   • 预留后续：在渲染进程实现最小的窗口控制按钮并通过 IPC                         │ │ 
 │ │     调用最小化/关闭（后续迭代）。                                                │ │ 
 │ │ 8. 文档与设计对齐                                                                │ │ 
 │ │ • 新增 docs/UI-Design-Integration.md：                                           │ │ 
 │ │   • 列出 tokens 来源、布局类名、各面板职责；                                     │ │ 
 │ │   • 记录如何启用/禁用自定义标题栏开关；                                          │ │ 
 │ │   • 标明测试覆盖点与已知未覆盖项（例如视觉一致性）。                             │ │ 
 │ │ 9. E2E（可选本次或下次迭代）                                                     │ │ 
 │ │ • 方案A（快速）：保留现有冒烟 e2e，不阻挡本次改造；                              │ │ 
 │ │ • 方案B（改进）：新增一个 e2e 用例，使用 vite 预览或 dev server，访问            │ │ 
 │ │   http://localhost:3001 并断言“AI 助手”与标题栏文本。                            │ │ 
 │ │   • 根据项目脚本决定在 CI 中如何先启动 dev:renderer。                            │ │ 
 │ │                                                                                  │ │ 
 │ │ 依赖与变更清单                                                                   │ │ 
 │ │ • 新增文件：                                                                     │ │ 
 │ │   • src/styles/tokens.css                                                        │ │ 
 │ │   • src/styles/layout.css                                                        │ │ 
 │ │   • （可选）src/components/Titlebar.jsx（如需要独立组件抽象）                    │ │ 
 │ │   • docs/UI-Design-Integration.md                                                │ │ 
 │ │   • src/__tests__/AppLayout.test.jsx                                             │ │ 
 │ │ • 修改文件：                                                                     │ │ 
 │ │   • src/index.jsx（引入新样式）                                                  │ │ 
 │ │   • src/App.jsx（重构布局 DOM 结构）                                             │ │ 
 │ │   • src/components/FileTree.css（替换为 tokens）                                 │ │ 
 │ │   • src/components/FilePreview.css（替换为 tokens）                              │ │ 
 │ │   • src/components/Chat/ChatPanel.css（替换为 tokens）                           │ │ 
 │ │   • （可选）src/main/windowOptions.js 与其测试（启用自定义标题栏时）             │ │ 
 │ │                                                                                  │ │ 
 │ │ 潜在风险与边界情况                                                               │ │ 
 │ │ • 深色主题变量化后，组件内硬编码颜色需全面替换，避免出现浅色残留或对比不足。     │ │ 
 │ │ • CSS resize 在极端宽度下溢出：通过 min/max-width                                │ │ 
 │ │   约束；主区最小宽度留足预览。                                                   │ │ 
 │ │ • 自定义标题栏涉及跨平台差异（Win/Linux 需要 frame: false；macOS 可用            │ │ 
 │ │   titleBarStyle），建议以开关控制并配套测试。                                    │ │ 
 │ │ • 现有 ChatPanel 单测依赖文本与占位符，不要改动这些文案（“AI                     │ │ 
 │ │   助手”“输入消息...”）。                                                         │ │ 
 │ │                                                                                  │ │ 
 │ │ 验收标准                                                                         │ │ 
 │ │ • 渲染 <App /> 时：                                                              │ │ 
 │ │   • 顶部出现设计稿风格标题栏文案；                                               │ │ 
 │ │   • 左侧“工作区文件”标题、工具栏、搜索可见；                                     │ │ 
 │ │   • 中间预览头部与内容可见；                                                     │ │ 
 │ │   • 右侧聊天面板“AI 助手”可见；                                                  │ │ 
 │ │   • 整体为深色主题，边框/背景/焦点与 tokens 一致；                               │ │ 
 │ │   • 所有现有单测通过；新增 AppLayout.test.jsx 通过；                             │ │ 
 │ │   • （若启用）windowOptions 标志位测试通过。                                     │ │ 
 │ │                                                                                  │ │ 
 │ │ 请确认                                                                           │ │ 
 │ │ • 是否本次就启用自定义标题栏（frame: false）？                                   │ │ 
 │ │ • 是否移除 antd 布局（推荐在本次完成，以便完全贴合设计）？                       │ │ 
 │ │ • E2E 是否一起升级到验证 React 主界面（否则保持现状，后续迭代）？